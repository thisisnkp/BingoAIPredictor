<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WinGo Predictor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <style>
        .prediction-card {
            transition: all 0.3s ease;
        }
        .prediction-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .high-confidence {
            animation: glow 2s ease-in-out infinite alternate;
        }
        @keyframes glow {
            from { box-shadow: 0 0 5px rgba(74, 222, 128, 0.3); }
            to { box-shadow: 0 0 15px rgba(74, 222, 128, 0.6); }
        }
        .prediction-loading {
            opacity: 0.7;
            pointer-events: none;
        }
        .red { color: #ef4444 !important; }
        .green { color: #22c55e !important; }
        .violet { color: #a855f7 !important; }
        .big { color: #059669 !important; }
        .small { color: #dc2626 !important; }
        .time-warning { color: #f59e0b !important; }
        .time-critical { 
            color: #ef4444 !important;
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .auto-prediction-active {
            color: #22c55e !important;
            font-weight: bold;
        }
        .color-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin: 0 1px;
        }
        .color-dot.red { background-color: #ef4444; }
        .color-dot.green { background-color: #22c55e; }
        .color-dot.violet { background-color: #a855f7; }
        .size-badge {
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
            color: white;
        }
        .size-badge.big { background-color: #22c55e; }
        .size-badge.small { background-color: #ef4444; }
        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            margin-bottom: 4px;
            background: rgba(0,0,0,0.05);
            border-radius: 6px;
            font-size: 12px;
        }
        .history-period {
            font-weight: bold;
            color: #666;
        }
        .history-result {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .stats-card {
            transition: transform 0.2s ease;
        }
        .stats-card:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="container-fluid p-3" style="width: 380px;">
        <!-- Header -->
        <div class="text-center mb-3 bg-primary bg-gradient text-white rounded p-2">
            <h5 class="mb-0">üéØ WinGo AI Predictor</h5>
            <small>Advanced Color & Size Prediction</small>
        </div>

        <!-- OpenAI API Key Setup -->
        <div class="card mb-3 border-warning" id="apiKeySection">
            <div class="card-header bg-warning bg-gradient">
                <h6 class="card-title mb-0">üîë AI Configuration</h6>
            </div>
            <div class="card-body p-3">
                <div class="mb-2">
                    <input type="password" id="apiKeyInput" class="form-control form-control-sm" 
                           placeholder="Enter OpenAI API Key (GPT-4 Required)">
                </div>
                <button id="saveApiKey" class="btn btn-sm btn-primary w-100">Save API Key</button>
                <div id="apiStatus" class="mt-2"></div>
            </div>
        </div>

        <!-- Auto Prediction Toggle -->
        <div class="card mb-3 border-success">
            <div class="card-header bg-success bg-gradient text-white">
                <h6 class="card-title mb-0">ü§ñ Smart Auto Mode</h6>
            </div>
            <div class="card-body p-3">
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="autoPrediction">
                    <label class="form-check-label fw-bold" for="autoPrediction">
                        Enable Auto Prediction
                    </label>
                </div>
                <small class="text-muted">Automatically predicts color & size when new period starts</small>
                <div id="autoStatus" class="mt-2 p-2 rounded" style="display: none;">
                    <small class="fw-bold">üü¢ Auto Mode Active - Monitoring for new periods...</small>
                </div>
            </div>
        </div>

        <!-- Enhanced Analysis Settings -->
        <div class="card mb-3 border-info">
            <div class="card-header bg-info bg-gradient text-white">
                <h6 class="card-title mb-0">‚öôÔ∏è AI Analysis Engine</h6>
            </div>
            <div class="card-body p-3">
                <div class="mb-3">
                    <label class="form-label fw-bold">Analysis Depth (Recent Results):</label>
                    <select id="analysisPages" class="form-select form-select-sm">
                        <option value="30">30 Results (Quick)</option>
                        <option value="50" selected>50 Results (Balanced)</option>
                        <option value="75">75 Results (Deep)</option>
                        <option value="100">100 Results (Advanced)</option>
                        <option value="150">150 Results (Expert)</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label fw-bold">AI Model:</label>
                    <select id="aiModel" class="form-select form-select-sm">
                        <option value="gpt-4" selected>GPT-4 (Best Accuracy)</option>
                        <option value="gpt-4-turbo">GPT-4 Turbo (Faster)</option>
                        <option value="gpt-3.5-turbo">GPT-3.5 (Economy)</option>
                    </select>
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="advancedAnalysis" checked>
                    <label class="form-check-label fw-bold" for="advancedAnalysis">
                        Advanced Pattern Recognition
                    </label>
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="statisticalAnalysis" checked>
                    <label class="form-check-label fw-bold" for="statisticalAnalysis">
                        Statistical Analysis
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="trendAnalysis" checked>
                    <label class="form-check-label fw-bold" for="trendAnalysis">
                        Trend Detection
                    </label>
                </div>
            </div>
        </div>

        <!-- Current Game Info -->
        <div class="card mb-3 border-secondary">
            <div class="card-header bg-secondary bg-gradient text-white">
                <h6 class="card-title mb-0">‚è∞ Live Game Status</h6>
            </div>
            <div class="card-body p-3">
                <div class="row g-2">
                    <div class="col-6">
                        <small class="text-muted fw-bold">Current Period:</small>
                        <div id="currentPeriod" class="fw-bold text-primary">-</div>
                    </div>
                    <div class="col-6">
                        <small class="text-muted fw-bold">Time Remaining:</small>
                        <div id="timeRemaining" class="fw-bold text-danger">-</div>
                    </div>
                </div>
                <div class="mt-2 pt-2 border-top">
                    <small class="text-muted fw-bold">AI Status:</small>
                    <div id="aiStatus" class="fw-bold text-info">Ready</div>
                </div>
            </div>
        </div>

        <!-- Enhanced Prediction Results -->
        <div class="card mb-3 border-success" id="predictionSection">
            <div class="card-header bg-success bg-gradient text-white d-flex justify-content-between align-items-center">
                <h6 class="card-title mb-0">üîÆ AI Prediction Engine</h6>
                <button id="sendToOverlay" class="btn btn-sm btn-outline-light" disabled>
                    Send to Overlay
                </button>
            </div>
            <div class="card-body p-3">
                <div class="prediction-result">
                    <div class="row g-2 mb-3">
                        <div class="col-6">
                            <div class="text-center p-3 bg-light rounded prediction-card">
                                <small class="text-muted fw-bold d-block">Color</small>
                                <div id="predictedColor" class="fw-bold fs-4 mt-1">-</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="text-center p-3 bg-light rounded prediction-card">
                                <small class="text-muted fw-bold d-block">Size</small>
                                <div id="predictedSize" class="fw-bold fs-4 mt-1">-</div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <small class="text-muted fw-bold">AI Confidence:</small>
                            <small id="confidenceText" class="fw-bold">0%</small>
                        </div>
                        <div class="progress mt-1" style="height: 12px;">
                            <div id="confidenceBar" class="progress-bar bg-success progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div id="predictionReasoning" style="display: none;">
                        <small class="text-muted fw-bold">AI Analysis:</small>
                        <div id="reasoningText" class="small text-secondary mt-1 p-2 bg-light rounded border-start border-primary border-3"></div>
                    </div>
                </div>
                <button id="getPrediction" class="btn btn-sm btn-success w-100 mb-2">
                    <span id="predictionBtnText">üß† Get AI Prediction</span>
                    <span id="predictionLoader" class="spinner-border spinner-border-sm ms-2" style="display: none;"></span>
                </button>
                <small class="text-muted d-block text-center">
                    Last prediction: <span id="lastPredictionTime">Never</span>
                </small>
            </div>
        </div>

        <!-- Enhanced Game History -->
        <div class="card mb-3 border-dark">
            <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                <h6 class="card-title mb-0">üìä Pattern History</h6>
                <button id="refreshHistory" class="btn btn-sm btn-outline-light">
                    ‚Üª Refresh
                </button>
            </div>
            <div class="card-body p-2">
                <div id="gameHistory" class="history-container" style="max-height: 180px; overflow-y: auto;">
                    <div class="text-center text-muted">
                        <div class="spinner-border spinner-border-sm" role="status"></div>
                        <small class="d-block mt-2">Loading pattern data...</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Statistics -->
        <div class="card mb-3 border-primary">
            <div class="card-header bg-primary bg-gradient text-white">
                <h6 class="card-title mb-0">üìà Performance Analytics</h6>
            </div>
            <div class="card-body p-3">
                <div class="row g-2 text-center mb-3">
                    <div class="col-3">
                        <div class="bg-light p-2 rounded stats-card">
                            <small class="text-muted fw-bold d-block">Accuracy</small>
                            <div id="accuracy" class="fw-bold text-success fs-5">0%</div>
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="bg-light p-2 rounded stats-card">
                            <small class="text-muted fw-bold d-block">Total</small>
                            <div id="totalPredictions" class="fw-bold fs-5">0</div>
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="bg-light p-2 rounded stats-card">
                            <small class="text-muted fw-bold d-block">Wins</small>
                            <div id="wins" class="fw-bold text-success fs-5">0</div>
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="bg-light p-2 rounded stats-card">
                            <small class="text-muted fw-bold d-block">Streak</small>
                            <div id="winStreak" class="fw-bold text-warning fs-5">0</div>
                        </div>
                    </div>
                </div>
                <div class="text-center">
                    <button id="resetStats" class="btn btn-sm btn-outline-danger">Reset Statistics</button>
                </div>
            </div>
        </div>

        <!-- Status -->
        <div id="status" class="text-center p-2 rounded">
            <small class="text-muted">üöÄ Advanced AI Predictor Ready</small>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="popup.js"></script>
</body>
</html>